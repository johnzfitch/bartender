// Bartender - Clean utilitarian bar
@use "sass:string";

// GTK alpha function wrapper
@function gtkalpha($c, $a) {
  @return string.unquote("alpha(#{$c},#{$a})");
}

// Lumon Theme - Severance inspired colors
$background: #0d1a1f;
$foreground: #6ef3ed;
$dim: rgba($foreground, 0.35);
$accent: #5dd9d3;
$bright-accent: #7ffff8;
$green: #5dd9d3;
$yellow: #7ffff8;
$red: #ff6b9d;

window.bartender {
  background: rgba(0, 0, 0, 0);
  font-family: "Berkeley Mono", "IBM Plex Mono", monospace;
  font-size: 14px;
  color: $foreground;
  // Lumon CRT glow effect
  text-shadow: 0 0 3px gtkalpha($accent, 0.3);

  > box {
    background: gtkalpha($background, 0.90);
    padding: 0 8px;
    border-bottom: 2px solid gtkalpha($accent, 0.5);
    // CRT glow effect - cyan drop shadow beneath the bar
    box-shadow:
      0 3px 15px gtkalpha($accent, 0.4),
      0 6px 30px gtkalpha($accent, 0.2),
      0 10px 50px gtkalpha($accent, 0.1);
  }

  // Strip button chrome
  button,
  menubutton > button {
    background: rgba(0, 0, 0, 0);
    border-width: 0px;
    padding: 8px 10px;
  }

  menubutton {
    background: rgba(0, 0, 0, 0);
    border-width: 0px;
  }

  // Popover keeps some structure
  popover {
    background: $background;
    color: $foreground;
    border: 1px solid rgba($foreground, 0.15);
    border-radius: 6px;
    padding: 8px;
  }

  // Workspaces - always 1-5, visual states like waybar
  .workspaces {
    .ws {
      padding: 4px 8px;
      margin: 2px 2px;
      font-size: 14px;
      font-weight: 400;
      color: rgba($foreground, 0.35);
      border-radius: 6px;

      &.occupied {
        color: rgba($foreground, 0.6);
      }

      &.focused {
        color: $foreground;
        background: rgba($foreground, 0.08);
      }

      &:hover {
        color: $accent;
        background: rgba($accent, 0.08);
      }
    }
  }

  // Clock - consistent spacing
  .clock {
    > button {
      padding: 8px 10px;
      color: $foreground;

      &:hover {
        color: $accent;
      }
    }
  }

  // Feed ticker
  .feed-ticker {
    padding: 8px 16px;
    font-size: 15px;
    font-weight: 700;
    color: $foreground;

    &.loading {
      color: $dim;
    }

    &.error {
      color: $red;
    }

    label {
      font-weight: 400;
    }

    &:hover label {
      color: $accent;
    }
  }

  // System tray - consistent spacing with other icons
  .tray {
    menubutton > button {
      &:hover image {
        opacity: 0.8;
      }
    }

    image {
      min-width: 18px;
      min-height: 18px;
    }
  }

  // Volume - consistent spacing
  .volume {
    > button {
      padding: 8px 10px;
      color: $foreground;

      &:hover {
        color: $accent;
      }

      image {
        min-width: 18px;
        min-height: 18px;
      }
    }

    slider {
      min-height: 6px;
      margin: 8px;

      trough {
        background: rgba($foreground, 0.15);
        border-radius: 3px;
        min-height: 6px;
      }

      highlight {
        background: $accent;
        border-radius: 3px;
      }

      slider {
        background: $foreground;
        border-radius: 6px;
        min-width: 12px;
        min-height: 12px;
        margin: 0px;
      }
    }
  }

  // Status widgets - consistent spacing and colors
  .vpn, .proxyforge, .audio, .comfyui {
    padding: 8px 10px;
  }

  .vpn {
    &.connected { color: $green; }
    &.connecting { color: $yellow; }
    &.disconnected { color: $dim; }
  }

  .proxyforge {
    &.proxyforge-active { color: $green; }
    &.proxyforge-starting,
    &.proxyforge-stopping { color: $yellow; }
    &.proxyforge-off { color: $dim; }
  }

  .comfyui {
    &.comfyui-running { color: $green; }
    &.comfyui-starting,
    &.comfyui-stopping { color: $yellow; }
    &.comfyui-stopped { color: $dim; }

    label {
      font-size: 12px;
    }
  }

  .audio {
    &.speakers { color: $foreground; }
    &.headphones { color: $foreground; }
    &.both { color: $green; }
    &.muted { color: $red; }
  }

  // WiFi widget
  .wifi {
    > button {
      padding: 8px 10px;
      color: $foreground;

      &:hover {
        color: $accent;
      }

      image {
        min-width: 18px;
        min-height: 18px;
      }
    }

    &.unavailable {
      min-width: 0px;
      min-height: 0px;
      padding: 0px;
      margin: 0px;
    }
  }

  // wifi-popover styles removed - GTK4 CSS compatibility

  // Bluetooth widget
  .bluetooth {
    > button {
      padding: 8px 10px;
      color: $dim;

      &:hover {
        color: $accent;
      }

      image {
        min-width: 18px;
        min-height: 18px;
      }
    }

    &.connected > button {
      color: $accent;
    }

    &.unavailable {
      min-width: 0px;
      min-height: 0px;
      padding: 0px;
      margin: 0px;
    }
  }

  .bluetooth-popover {

    .bluetooth-header {
      padding: 4px 8px;
      margin-bottom: 8px;
      border-bottom: 1px solid rgba($foreground, 0.1);

      label {
        font-weight: 700;
      }

      switch {
        // GTK4 CSS doesn't support margin-left: auto
        // Layout alignment should be handled in the widget code with halign
      }
    }

    .bluetooth-list {
      .bt-device {
        padding: 6px 8px;
        border-radius: 4px;

        &:hover {
          background: rgba($foreground, 0.1);
        }

        &.connected {
          color: $green;
        }

        image {
          min-width: 16px;
          min-height: 16px;
          margin-right: 8px;
        }
      }
    }
  }

  // Audio Mixer widget
  .audio-mixer {
    > button {
      padding: 8px 10px;
      color: $foreground;

      &:hover {
        color: $accent;
      }

      image {
        min-width: 18px;
        min-height: 18px;
      }
    }

    &.unavailable {
      min-width: 0px;
      min-height: 0px;
      padding: 0px;
      margin: 0px;
    }
  }

  .mixer-popover {
    padding: 8px;
    min-width: 280px;

    .mixer-devices {
      margin-bottom: 4px;

      .device-btn {
        padding: 6px 10px;
        border-radius: 4px;
        margin-bottom: 2px;
        background: transparent;

        &:hover {
          background: rgba($foreground, 0.08);
        }

        &.active {
          background: rgba($accent, 0.15);
          color: $accent;
        }

        image {
          min-width: 14px;
          min-height: 14px;
          margin-right: 8px;
        }

        label {
          font-size: 12px;
        }
      }
    }

    .mixer-jacks {
      margin-bottom: 4px;

      > box {
        // Horizontal button row
      }

      .jack-btn {
        padding: 6px 12px;
        border-radius: 4px;
        margin-right: 4px;
        background: rgba($foreground, 0.08);

        &:hover {
          background: rgba($foreground, 0.15);
        }

        &.active {
          background: rgba($accent, 0.2);
          color: $accent;
        }

        image {
          min-width: 16px;
          min-height: 16px;
          margin-right: 6px;
        }

        label {
          font-size: 11px;
        }
      }
    }

    .mixer-master {
      padding: 8px;
      margin-bottom: 8px;

      image {
        min-width: 20px;
        min-height: 20px;
        margin-right: 8px;
      }

      label {
        margin-right: 8px;
      }

      slider {
        min-height: 6px;

        trough {
          background: rgba($foreground, 0.15);
          border-radius: 3px;
          min-height: 6px;
        }

        highlight {
          background: $accent;
          border-radius: 3px;
        }

        slider {
          background: $foreground;
          border-radius: 6px;
          min-width: 12px;
          min-height: 12px;
          margin: 0px;
        }
      }
    }

    .mixer-divider {
      background: rgba($foreground, 0.1);
      min-height: 1px;
      margin: 4px 0;
    }

    .mixer-section-label {
      font-size: 12px;
      color: $dim;
      padding: 4px 8px;
    }

    .mixer-apps {
      .mixer-app {
        padding: 6px 8px;
        border-radius: 4px;
        margin-bottom: 4px;

        &:hover {
          background: rgba($foreground, 0.05);
        }

        image {
          min-width: 16px;
          min-height: 16px;
          margin-right: 8px;
        }

        label {
          margin-right: 8px;
        }

        .mute-btn {
          padding: 4px;
          border-radius: 4px;
          margin-right: 4px;

          &:hover {
            background: rgba($foreground, 0.1);
          }

          &.muted {
            color: $red;
          }

          image {
            min-width: 14px;
            min-height: 14px;
            margin: 0;
          }
        }

        slider {
          min-height: 4px;

          trough {
            background: rgba($foreground, 0.15);
            border-radius: 2px;
            min-height: 4px;
          }

          highlight {
            background: $accent;
            border-radius: 2px;
          }

          slider {
            background: $foreground;
            border-radius: 6px;
            min-width: 10px;
            min-height: 10px;
            margin: 0px;
          }
        }

        .mixer-app-route {
          margin-top: 4px;
          padding-left: 24px;

          image {
            min-width: 12px;
            min-height: 12px;
            margin-right: 6px;
            color: $dim;
          }

          .route-btn {
            padding: 2px 8px;
            border-radius: 3px;
            margin-right: 4px;
            font-size: 11px;
            background: rgba($foreground, 0.08);
            color: $dim;

            &:hover {
              background: rgba($foreground, 0.15);
              color: $foreground;
            }

            &.active {
              background: rgba($accent, 0.2);
              color: $accent;
            }
          }
        }
      }
    }
  }

  // Weather widget
  .weather {
    padding: 8px 12px;
    color: $foreground;

    &:hover {
      color: $accent;
    }

    &.error {
      color: $red;
    }

    .weather-condition {
      font-size: 14px;
    }

    .weather-temp {
      font-size: 14px;
    }

    .weather-hilo {
      font-size: 14px;
      color: $dim;

      image {
        min-width: 12px;
        min-height: 12px;
      }
    }

    .weather-precip {
      font-size: 14px;
      color: $accent;

      image {
        min-width: 12px;
        min-height: 12px;
      }
    }
  }


  // System Monitor widget
  .sysmon {
    > button {
      padding: 8px 10px;
      color: $foreground;

      &:hover {
        color: $accent;
      }
    }

    .sysmon-stat {
      &.normal { color: $foreground; }
      &.medium { color: $yellow; }
      &.high { color: $yellow; }
      &.critical { color: $red; }

      image {
        min-width: 14px;
        min-height: 14px;
      }

      label {
        font-size: 12px;
        font-weight: 700;
        min-width: 32px;
      }
    }
  }

  .sysmon-popover {
    padding: 8px;

    .sysmon-header {
      padding: 4px 8px;
      margin-bottom: 8px;
      border-bottom: 1px solid rgba($foreground, 0.1);

      label {
        font-weight: 700;
      }
    }

    .sysmon-detail {
      padding: 6px 8px;

      image {
        min-width: 18px;
        min-height: 18px;
      }

      .sysmon-label {
        font-size: 11px;
        color: $dim;
      }

      .sysmon-value {
        font-size: 13px;
        font-weight: 700;
      }
    }

    .sysmon-divider {
      background: rgba($foreground, 0.1);
      min-height: 1px;
      margin: 4px 0;
    }

    .sysmon-open {
      padding: 6px 12px;
      border-radius: 4px;
      background: rgba($foreground, 0.1);

      &:hover {
        background: rgba($foreground, 0.15);
      }
    }
  }

  // All images/icons inherit color
  image {
    -gtk-icon-style: symbolic;
  }
}

// Notification Panel - separate window
window.notification-panel {
  background: rgba(0, 0, 0, 0);
  font-family: "IBM Plex Sans", "SF Pro Display", "Fira Sans", "Berkeley Mono", sans-serif;
  font-size: 14px;
  color: $foreground;

  .panel-content {
    background: string.unquote("alpha(#{$background}, 0.95)");
    border-radius: 8px;
    border: 1px solid rgba($foreground, 0.1);
  }

  .panel-header {
    padding: 12px 16px;
    border-bottom: 1px solid rgba($foreground, 0.1);

    .panel-title {
      font-size: 16px;
      font-weight: 700;
      color: $foreground;
    }

    .clear-all {
      padding: 4px 12px;
      border-radius: 4px;
      background: rgba($foreground, 0.1);
      color: $foreground;

      &:hover {
        background: rgba($foreground, 0.15);
      }
    }
  }

  .panel-scroll {
    min-height: 200px;
  }

  .notification-list {
    padding: 8px;
  }

  .empty-state {
    padding: 40px;
    color: $dim;

    label {
      font-size: 14px;
    }
  }

  .notification-group {
    margin-bottom: 8px;

    &.collapsed {
      .group-header {
        padding: 12px;
        border-radius: 6px;
        background: rgba($foreground, 0.05);

        &:hover {
          background: rgba($foreground, 0.1);
        }

        image {
          min-width: 20px;
          min-height: 20px;
          margin-right: 8px;
        }

        .group-count {
          color: $dim;
          margin-right: 8px;
        }
      }
    }

    .group-header {
      padding: 8px 12px;
      margin-bottom: 4px;

      image {
        min-width: 16px;
        min-height: 16px;
        margin-right: 8px;
      }
    }
  }

  .notification {
    background: rgba($foreground, 0.05);
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 6px;
    border-left: 3px solid rgba(0, 0, 0, 0);

    &.critical {
      border-left-color: $red;
    }

    &.normal {
      border-left-color: $accent;
    }

    &.low {
      border-left-color: $dim;
    }

    .notification-header {
      margin-bottom: 6px;

      .notification-icon {
        min-width: 16px;
        min-height: 16px;
        margin-right: 8px;
      }

      .notification-app {
        font-size: 12px;
        font-weight: 700;
        color: $foreground;
      }

      .notification-time {
        font-size: 11px;
        color: $dim;
      }

      .notification-close {
        padding: 2px;
        border-radius: 4px;
        opacity: 0.5;

        &:hover {
          opacity: 1;
          background: rgba($foreground, 0.1);
        }

        image {
          min-width: 12px;
          min-height: 12px;
        }
      }
    }

    .notification-content {
      .notification-title {
        font-size: 13px;
        font-weight: 700;
        color: $foreground;
        margin-bottom: 4px;
      }

      .notification-body {
        font-size: 12px;
        color: rgba($foreground, 0.8);
      }
    }

    .notification-actions {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba($foreground, 0.1);

      .notification-action {
        padding: 4px 12px;
        border-radius: 4px;
        background: rgba($accent, 0.2);
        color: $accent;
        margin-right: 6px;

        &:hover {
          background: rgba($accent, 0.3);
        }
      }
    }
  }
}
